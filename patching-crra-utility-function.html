<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Patching utility functions - Tianhao&#x27;s website</title><meta name="description" content="Some utility functions have singularity u(c) --&gt; -infty as c--&gt;0. CRRA utility, which is a good example, is one of the most popular specifications that&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://clpr.github.io/patching-crra-utility-function.html"><link rel="alternate" type="application/atom+xml" href="https://clpr.github.io/feed.xml" title="Tianhao&#x27;s website - RSS"><link rel="alternate" type="application/json" href="https://clpr.github.io/feed.json" title="Tianhao&#x27;s website - JSON"><meta property="og:title" content="Patching utility functions"><meta property="og:site_name" content="Tianhao's website"><meta property="og:description" content="Some utility functions have singularity u(c) --&gt; -infty as c--&gt;0. CRRA utility, which is a good example, is one of the most popular specifications that&hellip;"><meta property="og:url" content="https://clpr.github.io/patching-crra-utility-function.html"><meta property="og:type" content="article"><link rel="preload" href="https://clpr.github.io/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://clpr.github.io/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://clpr.github.io/assets/css/style.css?v=0de5ed4b6a37ab1ddecf11b6f3d8bbb5"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://clpr.github.io/patching-crra-utility-function.html"},"headline":"Patching utility functions","datePublished":"2025-05-29T15:13+08:00","dateModified":"2025-05-29T16:04+08:00","description":"Some utility functions have singularity u(c) --&gt; -infty as c--&gt;0. CRRA utility, which is a good example, is one of the most popular specifications that&hellip;","author":{"@type":"Person","name":"Tianhao Zhao","url":"https://clpr.github.io/authors/tianhao-zhao/"},"publisher":{"@type":"Organization","name":"Tianhao Zhao"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script></head><body class="post-template"><div class="container"><header class="header"><div class="header__logo"><a class="logo" href="https://clpr.github.io/">Tianhao&#x27;s website</a></div><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://clpr.github.io/" target="_self">Home</a></li><li><a href="https://clpr.github.io/blogs.html" target="_self">Blogs</a></li><li><a href="https://clpr.github.io/research.html" target="_self">Research</a></li><li><a href="https://clpr.github.io/teaching.html" target="_self">Teaching</a></li><li><a href="https://clpr.github.io/data-and-code.html" target="_self">Data &amp; Code</a></li></ul></nav></header><main class="content"><article class="post"><header><h1 class="post__title">Patching utility functions</h1><div class="post__meta"><time datetime="2025-05-29T15:13" class="post__date">May 29, 2025 </time><span class="post__author"><a href="https://clpr.github.io/authors/tianhao-zhao/" class="feed__author">Tianhao Zhao</a></span></div></header><div class="post__entry"><p>Some utility functions have singularity <code>u(c) --&gt; -infty</code> as <code>c--&gt;0</code>. CRRA utility, which is a good example, is one of the most popular specifications that are de facto standard in today’s macroeconomic modeling. However, the singularity <code>u(c) --&gt; -infty</code> as <code>c</code> approaching zero brings annoying numerical challenges in practice. Even though in mathematics, such singularity ensures the optimal <code>c &gt;0</code> strictly, the numerical solvers, however, do not understand this implication and may try evaluating the Lagrangian/Hamiltonian at <code>c &gt;= 0</code>. This especially happens when the budget constraint leads to an irregular admissible space of <code>c</code> and one is using interior point solvers.</p><p>A traditional numerical trick is to set a small tolerace <code>d&gt;0</code>:</p><p>$$ u(c) \approx \frac{1}{1-\gamma}(c+d)^{1-\gamma} $$</p><p>such that some small negative <code>c</code> would not crash the whole program. Of course, the cost of such shifting operation is a little degree of risk aversion twist.</p><p>However, this trick is not good enough: how large should the <code>d</code> be to handle all the millions of grid points in each iteration? If <code>d</code> is too large, can we still claim that this is a CRRA utility?</p><p>Thus, a natural idea is to find a way to “extend” the CRRA utility function to the whole real line, while keeping the true CRRA utility function form without <code>d</code> in the regions where the optimal solution locate.</p><p>To be accurate: by setting a small enough positive threshold <code>m&gt;0</code>, for any <code>c&lt;m</code>, we replace the true CRRA utility function with a smooth extrapolation. The patched CRRA utility function is a piecewise function:</p><p>$$ \hat{u}(c) = \begin{cases} \frac{1}{1-\gamma}c^{1-\gamma} , c \geq m \ P(c|m) , c &lt; m \end{cases} $$</p><p>The extrapolation part <code>P</code> is strictly monotonic and smooth enough. We call this operation as “patching”, i.e. cut off the undesirable part of the true function at some point then “patch” the removed part with a patching function <code>P</code>. Intuitively, such patching does not affect the final solution when <code>m</code> is small enough regarding the final optimal consumption level. It only provides a large enough evaluable region for the numerical solvers to explore.</p><p>In the following sections, we discuss some widely used utility function forms and their <code>C^2</code> smooth patching.</p><h2 id="one-dimensional-crra">One dimensional CRRA</h2><p>OK, let’s do some math. Suppose we want a <code>C^2</code> patch function <code>P</code> for the one-dimensional CRRA utility <code>u(c)</code>. Let’s consider the following polynomial up to the 2nd order:</p><p>$$ P(c|m) := \beta_0 + \beta_1 c + \beta_2 c^2 $$</p><p>The <code>C^2</code> smoothness requries conditions at the boundary <code>c =m</code>:</p><p>$$ P(m|m) = \beta_0 + \beta_1 m + \beta_2 m^2 = \frac{1}{1-\gamma}m^{1-\gamma} $$</p><p>$$ P_m (m|m)=\beta_1 + 2\beta_2 m = m^{-\gamma} $$</p><p>$$ P_{mm}(m|m)=2\beta_2 = -\gamma m^{-\gamma-1} $$</p><p>Recursively solving the coefficients gives:</p><p>$$ \beta_2 = -\frac{\gamma}{2} m^{-\gamma-1} $$</p><p>$$ \beta_1 = (1-m \gamma) m^{-\gamma} $$</p><p>$$ \beta_0 = m^{1-\gamma} ( \frac{1}{1-\gamma} - 1 + m\gamma + \frac{\gamma}{2} ) $$</p><p>The separable CRRA utility used in <code>Jones, C., Midrigan, V. &amp; Philippon, T. (2022, Econometrica)</code> (“Household Leverage and the Recession.”) follows the same structure because of the additivity.</p><p>(more on the way…)</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on May 29, 2025</p><div class="post__share"></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://clpr.github.io/understanding-sequence-space-jacobian-ssj.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  Understanding Sequence Space Jacobian (SSJ) "><span class="btn__icon">←</span> <span class="btn__text">Understanding Sequence Space Jacobian (SSJ)</span></a></div></nav></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>© 2024 Powered by Publii CMS :: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank" rel="noopener">Theme</a> ported by the <a href="https://getpublii.com/customization-service/" target="_blank" rel="noopener">Publii Team</a></p></div></div></footer></div><script defer="defer" src="https://clpr.github.io/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>